<h5>Multipart form data</h5>

  <div w-nodev>

  <!-- https://hixie.ch/tests/adhoc/html/forms/submission/multipart_form-data/ -->

  <!-- NOTE: This algorithm is also used by the XHR spec -->

  <p>The <dfn data-export=""><code>multipart/form-data</code> encoding algorithm</dfn>, given a
  <var>form data set</var> and <var>encoding</var>, is as follows:</p>

  <ol>

   <!-- the first few steps of this are the same as in the previous section -->

   <li><p>Let <var>result</var> be the empty string.</p></li>

   <li><p>Let <var>charset</var> be the <span data-x="encoding name">name</span> of
   <var>encoding</var>.</p></li>

   <li>

    <p>For each entry in the <var>form data set</var>, perform these substeps:</p>

    <ol>

     <li><p>If the entry's name is "<code data-x="attr-fe-name-charset">_charset_</code>" and its
     type is "<code data-x="">hidden</code>", replace its value with <var>charset</var>.</p></li>

     <!-- the step that replaces a file with its name is missing in
     this version of the algorithm -->

     <li><p>For each character in the entry's name and value that cannot be expressed using the
     selected character encoding, replace the character by a string consisting of a U+0026 AMPERSAND
     character (&amp;), a U+0023 NUMBER SIGN character (#), one or more <span>ASCII digits</span>
     representing the Unicode code point of the character in base ten, and finally a U+003B
     SEMICOLON character (;).</p></li><!-- we should say it should be the shortest possible string,
     no leading zeros. this whole step is asinine, though, so... -->

     <!-- this is where the similarities with the previous section end -->

    </ol>

   </li>

   <li>

    <p>Encode the (now mutated) <var>form data set</var> using the rules described by RFC 7578,
    <cite>Returning Values from Forms: <code data-x="">multipart/form-data</code></cite>, and return
    the resulting byte stream. <ref spec=RFC7578></p>

    <p>Each entry in the <var>form data set</var> is a <i>field</i>, the name of the entry is the
    <i>field name</i> and the value of the entry is the <i>field value</i>.</p>

    <p>The order of parts must be the same as the order of fields in the <var>form data set</var>.
    Multiple entries with the same name must be treated as distinct fields.</p>

    <p>The parts of the generated <code>multipart/form-data</code> resource that correspond to
    non-file fields must not have a `<code>Content-Type</code>` header specified. Their names and
    values must be encoded using the character encoding selected above.</p>

    <p>File names included in the generated <code>multipart/form-data</code> resource (as part of
    file fields) must use the character encoding selected above, though the precise name may be
    approximated if necessary (e.g. newlines could be removed from file names, quotes could be
    changed to "%22", and characters not expressible in the selected character encoding could be
    replaced by other characters).

    <p>The boundary used by the user agent in generating the return value of this algorithm is the
    <dfn data-export=""><code>multipart/form-data</code> boundary string</dfn>. (This value is used
    to generate the MIME type of the form submission payload generated by this algorithm.)</p>

   </li>

  </ol>

  </div>

  <p>For details on how to interpret <code>multipart/form-data</code> payloads, see RFC 7578. <ref
  spec=RFC7578></p>


  