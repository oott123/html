  <h5>Definitions</h5>

  <p>To coordinate events, user interaction, scripts, rendering, networking, and so forth, user
  agents must use <dfn data-x="event loop" data-lt="event loop" data-export="">event loops</dfn> as
  described in this section. There are two kinds of event loops: those for <span
  data-x="browsing context">browsing contexts</span>, and those for <a
  href="#workers">workers</a>.</p>

  <p>There must be at least one <span>browsing context</span> <span>event loop</span> per user
  agent, and at most one per <span>unit of related similar-origin browsing contexts</span>.</p>

  <p class="note">When there is more than one <span>event loop</span> for a <span>unit of related
  browsing contexts</span>, complications arise when a <span>browsing context</span> in that group
  is <span data-x="navigate">navigated</span> such that it switches from one <span>unit of related
  similar-origin browsing contexts</span> to another. This specification does not currently describe
  how to handle these complications.</p>

  <p>A <span>browsing context</span> <span>event loop</span> always has at least one <span>browsing
  context</span>. If such an <span>event loop</span>'s <span data-x="browsing context">browsing
  contexts</span> all go away, then the <span>event loop</span> goes away as well. A <span>browsing
  context</span> always has an <span>event loop</span> coordinating its activities.</p>

  <p><a href="#worker-event-loop">Worker event loops</a> are simpler: each worker has one
  <span>event loop</span>, and the <span data-x="run a worker">worker processing model</span>
  manages the <span>event loop</span>'s lifetime.</p>

  <hr>

  <p>An <span>event loop</span> has one or more <dfn data-x="task queue">task queues</dfn>. A
  <span>task queue</span> is an ordered list of <dfn data-x="concept-task" data-lt="task"
  data-export="">tasks</dfn>, which are algorithms that are responsible for such work as:</p>

  <dl>

   <dt>Events</dt>

   <dd>

    <p>Dispatching an <code>Event</code> object at a particular
    <code>EventTarget</code> object is often done by a dedicated task.</p>

    <p class="note">Not all events are dispatched using the <span>task queue</span>, many are
    dispatched during other tasks.</p>

   </dd>


   <dt>Parsing</dt>

   <dd><p>The <span>HTML parser</span> tokenizing one or more bytes, and then processing any
   resulting tokens, is typically a task.</p></dd>


   <dt>Callbacks</dt>

   <dd><p>Calling a callback is often done by a dedicated task.</p></dd>


   <dt>Using a resource</dt>

   <dd><p>When an algorithm <span data-x="concept-fetch">fetches</span> a resource, if the fetching
   occurs in a non-blocking fashion then the processing of the resource once some or all of the
   resource is available is performed by a task.</p></dd>


   <dt>Reacting to DOM manipulation</dt>

   <dd><p>Some elements have tasks that trigger in response to DOM manipulation, e.g. when that
   element is <span data-x="node is inserted into a document">inserted into the document</span>.</p>

  </dl>

  <p>Each <span data-x="concept-task">task</span> in a <span>browsing context</span> <span>event
  loop</span> is associated with a <code>Document</code>; if the task was queued in the context of
  an element, then it is the element's <span>node document</span>; if the task was queued in the context
  of a <span>browsing context</span>, then it is the <span>browsing context</span>'s <span>active
  document</span> at the time the task was queued; if the task was queued by or for a <span
  data-x="concept-script">script</span> then the document is the <span>responsible document</span>
  specified by the script's <span>settings object</span>.</p>

  <p>A <span data-x="concept-task">task</span> is intended for a specific <span>event loop</span>:
  the <span>event loop</span> that is handling <span data-x="concept-task">tasks</span> for the
  <span data-x="concept-task">task</span>'s associated <code>Document</code> or <a
  href="#workers">worker</a>.</p>

  <p>When a user agent is to <dfn data-export="">queue a task</dfn>, it must add the given task to
  one of the <span data-x="task queue">task queues</span> of the relevant <span>event
  loop</span>.</p>

  <p>Each <span data-x="concept-task">task</span> is defined as coming from a specific <dfn
  data-export="">task source</dfn>. All the tasks from one particular <span>task source</span> and
  destined to a particular <span>event loop</span> (e.g. the callbacks generated by timers of a
  <code>Document</code>, the events fired for mouse movements over that <code>Document</code>, the
  tasks queued for the parser of that <code>Document</code>) must always be added to the same
  <span>task queue</span>, but <span data-x="concept-task">tasks</span> from different <span
  data-x="task source">task sources</span> may be placed in different <span data-x="task queue">task
  queues</span>.</p>

  <p class="example">For example, a user agent could have one <span>task queue</span> for mouse and
  key events (the <span>user interaction task source</span>), and another for everything else. The
  user agent could then give keyboard and mouse events preference over other tasks three quarters of
  the time, keeping the interface responsive but not starving other task queues, and never
  processing events from any one <span>task source</span> out of order.</p>

  <p>Each <span>event loop</span> has a <dfn>currently running task</dfn>. Initially, this is null.
  It is used to handle reentrancy. Each <span>event loop</span> also has a <dfn>performing a
  microtask checkpoint</dfn> flag, which must initially be false. It is used to prevent reentrant
  invocation of the <span>perform a microtask checkpoint</span> algorithm.</p>

